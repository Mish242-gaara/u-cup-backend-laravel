[www]
user = www-data
group = www-data

; CORRECTION CRITIQUE : Utilisation d'une socket Unix pour de meilleures performances/sécurité
; Assurez-vous que le répertoire /var/run/php existe et a les bonnes permissions (normalement géré par le Dockerfile)
listen = /var/run/php/php-fpm.sock

; Permissions de la socket (requis pour Nginx pour lire la socket)
listen.owner = www-data 
listen.group = www-data 
listen.mode = 0660 

pm = dynamic
pm.max_children = 5  ; Augmenté légèrement pour un meilleur throughput de base
pm.start_servers = 2
pm.min_spare_servers = 1
pm.max_spare_servers = 3

; IMPORTANT : Ajout de catch_workers_output pour forcer les logs des workers vers stderr.
; Ceci est CRITIQUE pour diagnostiquer l'exit status 78.
catch_workers_output = yes

; Directive pour que les logs PHP-FPM (warnings/errors) apparaissent dans le log de Render via Supervisor
php_admin_flag[log_errors] = on
php_admin_value[error_log] = /dev/stderr 

php_admin_value[memory_limit] = 128M

; Assurez-vous que cgi.fix_pathinfo est désactivé (0) pour les applications modernes.
; Laravel n'a généralement PAS besoin de cgi.fix_pathinfo=1. 
; Le laisser à 1 peut être une faille de sécurité.
php_admin_flag[cgi.fix_pathinfo] = 0