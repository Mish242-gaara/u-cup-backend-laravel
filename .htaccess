<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # Rediriger tout vers le dossier public
    RewriteRule ^(.*)$ public/$1 [L]
    
    # Désactiver le listing des répertoires
    Options -Indexes
    
    # Configurer les en-têtes de sécurité
    <IfModule mod_headers.c>
        Header set X-Content-Type-Options "nosniff"
        Header set X-Frame-Options "SAMEORIGIN"
        Header set X-XSS-Protection "1; mode=block"
    </IfModule>
    
    # Gérer les erreurs
    ErrorDocument 404 /index.php
    
    # Désactiver le cache pour les fichiers dynamiques
    <FilesMatch "\.(php|html?|feed|pdf|vcf|raw)$">
        <IfModule mod_headers.c>
            Header set Cache-Control "private, no-cache, no-store, proxy-revalidate, no-transform"
            Header set Pragma "no-cache"
        </IfModule>
    </FilesMatch>
    
    # Activer le cache pour les assets statiques
    <FilesMatch "\.(js|css|png|jpg|jpeg|gif|ico|woff2?|svg|ttf|eot)$">
        <IfModule mod_headers.c>
            Header set Cache-Control "public, max-age=31536000, immutable"
        </IfModule>
    </FilesMatch>
</IfModule>

# Configurer PHP pour InfinityFree
<IfModule mod_php.c>
    php_flag display_errors Off
    php_value max_execution_time 300
    php_value memory_limit 256M
    php_value upload_max_filesize 64M
    php_value post_max_size 64M
    php_value session.gc_maxlifetime 1440
</IfModule>

# Désactiver l'accès aux fichiers sensibles
<Files ".env">
    Order allow,deny
    Deny from all
</Files>

<Files "artisan">
    Order allow,deny
    Deny from all
</Files>

<Files "composer.json">
    Order allow,deny
    Deny from all
</Files>

<Files "composer.lock">
    Order allow,deny
    Deny from all
</Files>

# Redirection HTTP vers HTTPS (si disponible)
# RewriteCond %{HTTPS} off
# RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Configuration spécifique pour les routes Laravel
<IfModule mod_rewrite.c>
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^ index.php [L]
</IfModule>